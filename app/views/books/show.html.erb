<%= render 'users/user_info',user: @user %>   
        
        <h2 class="mt-3">New book</h2>
        <% if @newbook.errors.any? %>
          <%= @newbook.errors.count %>error prohibited this book from being saved:
          <% @newbook.errors.full_messages.each do |message| %>
           <%= message %>
         <% end %>
        <% end %>
        <!-- form_with部分 -->
        <%= form_with model:@newbook, local:true do |f| %>
        <h4>Title</h4>
        <%= f.text_field :title %>

        <h4>Opinion</h4>
        <%= f.text_area :body %>

        <br><%= f.submit 'Create Book', class:"btn btn-success" %></br>

        <% end %>

      </div>
<div class="col-md-8 offset-md-1">
<h1>Book detail</h1>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Opinion</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <tr>
    <td><%= link_to user_path(@book.user.id) do %>
          <%= attachment_image_tag @user, :profile_image, :fill, 40, 40, format: 'jpeg', fallback: "no_image.jpg" %>
          <%= @user.name %>
        <% end %></td>
        
    <td><%= link_to book_path(@book.id) do %>
          <%= @book.title %>
        <% end %></td>
        
    <td><%= @book.body %></td>
    <% if @book.user == current_user %>
      <td><%= link_to "Edit", edit_book_path(@book) %></td>
      <td><%= link_to "Destroy", book_path(@book), method: :delete, "data-confirm" => "Are you sure?" %></td>
    <% end %>
    </tr>
     <% if @book.favorited_by?(current_user) %>
    <p>
      <%= link_to book_favorites_path(@book), method: :delete do %>
        ♥<%= @book.favorites.count %> いいね
      <% end %>
    </p>
    <% else %>
    <p>
      <%= link_to book_favorites_path(@book), method: :post do %>
        ♡<%= @book.favorites.count %> いいね
      <% end %>
    </p>
  <% end %>
    
    <div class="comments">
    <p>コメント件数：<%= @book.comments.count %></p>
       <% @book.comments.each do |comment| %>
    <p><%#= image_tag('sample-author1.jpg') %></p>
         <%= comment.user.name %>
         <%= comment.created_at.strftime('%Y/%m/%d') %><%= comment.comment %>
    
    <% if comment.user == current_user %>
      <div class="comment-delete">
         <%= link_to "削除", book_comment_path(comment.book, comment), method: :delete %>
      </div>
    <% end %>
       <% end %>
    </div>
    
    <div class="new-comment">
     <%= form_with(model:[@book, @comment], local: true) do |f| %>
       <%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
       <%= f.submit "送信する" %>
     <% end %>
    </div>
  </table>
</div>
</div>
</div>

